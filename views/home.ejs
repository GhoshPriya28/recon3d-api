<%- include ("header") %>
  <%- include ("sidebar") %>

    <head>
      <link href="//maxcdn.bootstrapcdn.com/bootstrap/3.3.0/css/bootstrap.min.css" rel="stylesheet" id="bootstrap-css">
      <script src="//maxcdn.bootstrapcdn.com/bootstrap/3.3.0/js/bootstrap.min.js"></script>
      <script src="//code.jquery.com/jquery-1.11.1.min.js"></script>
      <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.4.0/jquery.min.js"></script>
      <script src="https://cdnjs.cloudflare.com/ajax/libs/sweetalert/2.1.2/sweetalert.min.js"></script>
      <link rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-datepicker/1.6.4/css/bootstrap-datepicker.css" />
    <script src="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-datepicker/1.6.4/js/bootstrap-datepicker.js"></script>

    <link rel="stylesheet" href="/stylesheets/styles.css">
    <script src="/javascripts/stislas.js"></script>
    <script src="/javascripts/scriptsdata.js"></script>
    </head>

    <div class="main-content">
      <section class="section">
        <div class="section-header">
          <h1>Profile</h1>
          <div class="section-header-breadcrumb">
            <div class="breadcrumb-item active"><a href="/web/admin/dashboard">Dashboard</a></div>
            <div class="breadcrumb-item">Profile</div>
          </div>
        </div>
        <div class="section-body">
          <div class="invoice">
            <div class="invoice-print">
              <div class="row">
                <div class="container">
                  <div class="row">

                    <div class="col-md-12 ">

                      <div class="panel panel-default">
                        <div class="panel-heading">
                          <h4>User Profile</h4>
                        </div>
                        <div class="panel-body">
                          <% 
                         
                          for(var i=0; i < data.length; i++) { 
                            
                            
                            %>

                            <input type="hidden" id="email" name="id" value="<%= data[i].email %>" />
                            
                             <input type="hidden" id="id" name="id" value="<%= data[i].id %>" />
                            <div class="box box-info">

                              <div class="box-body">
                                <div class="col-sm-6">
                                  <div align="center">
                                    <% if(data[i].user_profile_pic) { %>
                                      <img alt="image" src="<%= url+data[i].user_profile_pic%>"
                                        class="rounded-circle profile-widget-picture" style="height: 52px;">
                                      <% } else { %>
                                        <img alt="image" src="/images/avatar/avatar-1.png"
                                          class="rounded-circle profile-widget-picture"
                                          style="height: 72px;margin: 10px 10px 10px 0px;">
                                        <% } %>




                                  </div>

                                  <br>

                                  <!-- /input-group -->
                                </div>
                                <div class="col-sm-6">
                                  <h4 style="color:#00b1b1;">
                                    <%= data[i].first_name + " " + data[i].last_name %>
                                  </h4></span>

                                </div>
                                <div class="clearfix"></div>
                                <hr style="margin:5px 0 5px 0;">


                                <div class="col-sm-5 col-xs-6 tital ">First Name:</div>

                                <div class="col-sm-7 col-xs-6 ">
                                  <input type="text" class="form-control" id="first_name" value="<%=data[i].first_name %>">
                                </div>
                                <div class="clearfix"></div>
                                <div class="bot-border"></div>


                                <div class="bot-border"></div>

                                <div class="col-sm-5 col-xs-6 tital ">Last Name:</div>
                                <div class="col-sm-7">
                                  <input type="text" class="form-control" id="last_name" value="<%=data[i].last_name%>" >
                                </div>
                                <div class="clearfix"></div>
                                <div class="bot-border"></div>

                                <div class="col-sm-5 col-xs-6 tital ">Email:</div>
                                <div class="col-sm-7">
                                  <input type="text" class="form-control" readonly id="email" value="<%=data[i].email%>"" >
                                  <input type="hidden"  id="uemail" value="<%=data[i].email%>" >
                                </div>

                                <div class="clearfix"></div>
                                <div class="bot-border"></div>

                                <div class="col-sm-5 col-xs-6 tital ">Mobile Number:</div>
                                <div class="col-sm-7">
                                  <input type="number" class="form-control" id="user_mobile" value="<%=data[i].user_mobile%>">
                                </div>

                                <div class="clearfix"></div>
                                <div class="bot-border"></div>

                                <div class="col-sm-5 col-xs-6 tital ">Company Name:</div>
                                <div class="col-sm-7">
                                  <input type="text" id="orgnization_name" class="form-control" value="<%=data[i].orgnization_name%>">
                                </div>

                                <div class="clearfix"></div>
                                <div class="bot-border"></div>
                                <div class="col-sm-5 col-xs-6 tital ">Job Priority:</div>
                                <div class="col-sm-7">
                                  <select class="form-control" style="padding:0px;" id="job_priority" name="job_priority">
                                   
                                    <option value="1" <%= ( data[i].job_priority == 1 ) ? "selected" : "" %>>Low</option>
                                    <option value="2" <%= ( data[i].job_priority == 2 ) ? "selected" : "" %>>Medium</option>
                                    <option value="3" <%= ( data[i].job_priority == 3 ) ? "selected" : "" %>>High</option>
                                  </select>
                                  
                                </div>

                                <div class="clearfix"></div>
                                <div class="bot-border"></div>


                                <!-- /.box-body -->
                              </div>
                              <!-- /.box -->


                              <div class="card-footer text-right">
                                <!-- <button type="submit" id="editcoll" class="btn btn-primary">Edit</button> -->
                                <button type="submit" id="updatecoll" class="btn btn-primary">Update</button>
                                <button type="button" onclick="history.go(-1)" class="btn btn-primary">Back</button>
                                <button type="submit" id="deletecoll" class="btn btn-primary">Delete</button>
                                <button type="submit" id="login" class="btn btn-primary">Reset Password </button>
                                <button type="submit" id="reminder" class="btn btn-primary">Reminder
                                  Notification</button>
                              </div>
                            </div>

                            <% }%>
                        </div>
                      </div>
                    </div>

                    <div class="container">
                        <div class="row">
      
                          <div class="col-md-12 ">
      
                            <div class="panel panel-default">
                              <div class="panel-heading">
                                <h4>Subscription</h4>
                              </div>
                              <div class="panel-body">
                                <% for(var i=0; i < data.length; i++) { %>
      
                                 
                                  <div class="box box-info">
                                      <div class="col-sm-4">
                                      <select class="form-control" style="padding:0px;" name="is_subscribe" id="is_subscribe">
                                         <option  value="" disabled selected>Choose</option>
                                         <option  value="1" <%= ( data[i].is_subscribe == 1 ) ? "selected" : "" %> >Subscribed</option>
                                         <option value="0" <%= ( data[i].is_subscribe == 0 ) ? "selected" : "" %>>Free</option>
                                      </select>
                                      </div>
                                      <div class="col-sm-2">
                                      <select class="form-control" id="subscribed" name="subss" style="padding:0px;" >
                                        <option value="" disabled selected>Select Plan</option>
                                        <option value="com.Recon3d.OneYearPack">com.Recon3d.OneYearPack</option>
                                        <option value="com.Recon3D.StandardOneMonthPack">com.Recon3D.StandardOneMonthPack</option>
                                      </select>
                                    </div>
                                    <div class="card-footer text-right">
                                      <button type="submit" id="changeSubscription" class="btn btn-primary">Change Subscription </button>
                                    </div>
                                  </div>
                                  <% }%>
                              </div>
                            </div>
                          </div>
                        </div>
                    </div>

                    <!-- subscribe start -->
                    <div class="container">
                    <div class="row">
    
                    <div class="col-md-12 ">
                    <div class="panel panel-default">
                      <div class="panel-heading">
                        <h4>Subscribe Trial</h4>
                      </div>
                      <% for(var i=0; i < data.length; i++) { console.log(data); if(data[i].is_subscribe!=1) { %>
                      <div class="panel-body">
                        
                        
                          <input type="hidden" id="id" name="id" value="<%= data[i].id %>" />

                            <div class="box box-info">
                              <div class="box-body">
                                <div class="clearfix"></div>
                                <hr style="margin:5px 0 5px 0;">
                                <div class="input-daterange">
                        
                               

                                <div class="col-sm-5 col-xs-6 tital ">Subscribed Start:</div>
                                <div class="col-sm-7">
                                  
                                  <input type="text" class="form-control" value="<%= data[i].subscribe_starts %>" id="subscribe_starts" placeholder="Start">
                                </div>
                                <div class="clearfix"></div>
                                <div class="bot-border"></div>

                                <div class="col-sm-5 col-xs-6 tital ">Subscribed End:</div>
                              <div class="col-sm-7">
                                <input type="text" class="form-control" value="<%= data[i].subscribe_ends %>" id="subscribe_ends" placeholder="End">
                              </div>
                              </div>
                              <div class="clearfix"></div>
                              <div class="bot-border"></div>

                              <div class="card-footer text-right">
                                <button type="submit" id="submitcoll" class="btn btn-primary">Submit</button>
                              </div>
                            </div>
                          </form>
                          
                      </div>
                      <% } }%>



                      </div>
                      </div>
                      </div>
                    </div>
                    <!-- subscribe div end -->
                    <script>
                      $(function () {
                        $('#profile-image1').on('click', function () {
                          $('#profile-image-upload').click();
                        });
                      });       
                    </script>


                  </div>
                </div>

              </div>

            </div>
          </div>
        </div>


    </div>


    </div>
    </div>
    </section>
    </div>
    <script type="text/javascript"
      src="https://cdn.jsdelivr.net/npm/sweetalert2@11.3.2/dist/sweetalert2.all.min.js"></script>
    <script type="text/javascript"
      src="https://cdn.jsdelivr.net/npm/sweetalert2@11.3.2/dist/sweetalert2.all.min.js"></script>

    <body>
      <script type="text/javascript">
        $(document).ready(function () {
          $('.input-daterange').datepicker({
                todayBtn: 'linked',
                format: "yyyy-mm-dd",
                autoclose: true
        });


          $("#login").click(function () {


            Swal.fire({
              title: 'Do you want to save the changes?',
              showDenyButton: false,
              showCancelButton: true,
              confirmButtonText: 'Save',
              denyButtonText: `Don't save`,
            }).then((result) => {
              /* Read more about isConfirmed, isDenied below */
              if (result.isConfirmed) {

                //    $("#profileform").submit();

                var email = $("#email").val();
                var url = "/web/admin/resetPasswordEmail/" + email;
                $.get(url)
                  .done(function (data) {
                    if (data.message) {
                      Swal.fire({
                        icon: 'success',
                        title: '',
                        text: data.message,
                      });

                    }
                    else {
                      Swal.fire({
                        icon: 'error',
                        title: 'Oops...',
                        text: data.message,
                      });
                    }

                  });

                //Swal.fire('Saved!', '', 'success')
              } else if (result.isDenied) {
                Swal.fire('Changes are not saved', '', 'info')
              }

            });

          });

          $("#updatecoll").click(function () {

            Swal.fire({
              title: 'Do you want to update profile?',
              showDenyButton: false,
              showCancelButton: true,
              confirmButtonText: 'Update',
              denyButtonText: `Don't Update`,
            }).then((result) => {
              if (result.isConfirmed) {
                // var fname = $("#fname").val();
                // var lname = $("#lname").val();
                // var org = $("#org").val();
                var url = "/web/admin/profile-update/";
                $.post(url,{
            // email:$("#email").val(),
            first_name: $("#first_name").val(),
            last_name: $("#last_name").val(),
            orgnization_name: $("#orgnization_name").val(),
            user_mobile: $("#user_mobile").val(),
            job_priority: $("#job_priority").val(),
            id: $("#id").val(),
                } )
                  .done(function (data) {
                    if (data.message) {
                      Swal.fire({
                        icon: 'success',
                        title: '',
                        text: data.message,
                      });

                    }
                    else {
                      Swal.fire({
                        icon: 'error',
                        title: 'Oops...',
                        text: data.message,
                      });
                    }

                  });
              } else if (result.isDenied) {
                Swal.fire('Changes are not updated', '', 'info')
              }

            });

          });
          
          
          $("#reminder").click(function () {

            Swal.fire({
              title: 'Do you want to give reminder?',
              showDenyButton: false,
              showCancelButton: true,
              confirmButtonText: 'Submit',
              denyButtonText: `Don't Submit`,
            }).then((result) => {
              if (result.isConfirmed) {
                var url = "/web/admin/reminder-notification/";
                $.post(url, {
                  email: $("#email").val(),
                  id: $("#id").val(),
                })
                  .done(function (data) {
                    if (data.message) {
                      Swal.fire({
                        icon: 'success',
                        title: '',
                        text: data.message,
                      });

                    }
                    else {
                      Swal.fire({
                        icon: 'error',
                        title: 'Oops...',
                        text: data.message,
                      });
                    }

                  });
              } else if (result.isDenied) {
                Swal.fire('Changes are not submitted', '', 'info')
              }

          });

          });

          
          //Subscription change by admin..
          $("#changeSubscription").click(function () {
            Swal.fire({
              title: 'Do you want to save the changes?',
              showDenyButton: false,
              showCancelButton: true,
              confirmButtonText: 'Save',
              denyButtonText: `Don't save`,
            }).then((result) => {
              /* Read more about isConfirmed, isDenied below */
              if (result.isConfirmed) {
                //    $("#profileform").submit();
                var email = $("#uemail").val();
               // alert(email)
                console.log("email", email);
                var subscribe = $("#is_subscribe").val();
                var subscribed = $("#subscribed").val();
               // alert(subscribed)
                var url = "/web/admin/change_subscription_by_admin?email=" + email+"&subscribe="+subscribe + "&subscribed=" + subscribed;
                $.get(url)
                  .done(function (data) {
                    if (data.message) {
                      Swal.fire({
                        icon: 'success',
                        title: '',
                        text: data.message,
                      });
                    }
                    else {
                      Swal.fire({
                              icon: 'error',
                              title: 'Oops...',
                              text: data.message,
                      });
                    }
                  });
                //Swal.fire('Saved!', '', 'success')
              } else if (result.isDenied) {
                Swal.fire('Changes are not saved', '', 'info')
              }
            });
          });



          $("#submitcoll").click(function () {
            Swal.fire({
              title: 'Do you want to submit?',
              showDenyButton: false,
              showCancelButton: true,
              confirmButtonText: 'Submit',
              denyButtonText: `Don't Submit`,
            }).then((result) => {
              if (result.isConfirmed) {
                var url = "/web/admin/subscribe-user";
                $.post(url, {
                  subscribe_starts: $("#subscribe_starts").val(),
                  subscribe_ends: $("#subscribe_ends").val(),
                  id: $("#id").val(),
                })
                  .done(function (data) {
                    if (data.message) {
                      Swal.fire({
                        icon: 'success',
                        title: '',
                        text: data.message,
                      });
                    }
                    else {
                      Swal.fire({
                        icon: 'error',
                        title: 'Oops...',
                        text: data.message,
                      });
                    }
                  });
              } else if (result.isDenied) {
                Swal.fire('Changes are not submitted', '', 'info')
              }

            });

          });


          $("#deletecoll").click(function () {

            Swal.fire({
              title: 'Do you want to delete?',
              showDenyButton: false,
              showCancelButton: true,
              confirmButtonText: 'Delete',
              denyButtonText: `Don't Delete`,
            }).then((result) => {
              if (result.isConfirmed) {
                var url = "/web/admin/update-email/";
                $.post(url, {
                  email: $("#email").val(),
                  id: $("#id").val(),
                })
                  .done(function (data) {
                    if (data.message) {
                      Swal.fire({
                        icon: 'success',
                        title: '',
                        text: data.message,
                      });

                    }
                    else {
                      Swal.fire({
                        icon: 'error',
                        title: 'Oops...',
                        text: data.message,
                      });
                    }

                  });
              } else if (result.isDenied) {
                Swal.fire('Changes are not deleted', '', 'info')
              }

            });

          });





        });


      </script>
    </body>

    <style>
      input.hidden {
        position: absolute;
        left: -9999px;
      }

      #profile-image1 {
        cursor: pointer;

        width: 100px;
        height: 100px;
        border: 2px solid #03b1ce;
      }

      .tital {
        font-size: 16px;
        font-weight: 500;
      }

      .bot-border {
        border-bottom: 1px #f8f8f8 solid;
        margin: 5px 0 5px 0
      }
    </style>
    <%- include ("footer") %>