<%- include ("header") %>
  <%- include ("sidebar") %>
  <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css" integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T" crossorigin="anonymous">
    <link rel="stylesheet"
  href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-datepicker/1.6.4/css/bootstrap-datepicker.css" />
    <script src="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-datepicker/1.6.4/js/bootstrap-datepicker.js"></script>

    <link rel="stylesheet" href="/stylesheets/styles.css">
    <script src="/javascripts/stislas.js"></script>
    <script src="/javascripts/scriptsdata.js"></script>
    <script src="/javascripts/touch-dnd.js"></script>

    <div class="main-content">
      <section class="section">
        <div class="section-header">
          <h2>Job Priority </h2>

          <div class="section-header-breadcrumb">
            <div class="breadcrumb-item active"><a href="/web/admin/dashboard">Dashboard</a></div>
            <div class="breadcrumb-item">Job Priority </div>
          </div>
        </div>

         <body>
          <div class="section-body">
            <div class="row mt-4">
              <div class="col-12">
                <div class="card">
                  <div class="card-body">
                    <div class="clearfix mb-3"></div>
                    <div class="container">
                    <div class="row">
                        <!--<h2>Jobs</h2>
                            <ul class="grid wide">
                            <% 
                            console.log(scanListAr.length);
                                if(scanListAr.length>0)
                                {
                                    for(var i=0; i < scanListAr.length; i++) { 
                                        
                                    %>
                                    <li class="draggable <%=scanListAr[i].bg %>  text-white" value="<%=scanListAr[i].initiate_id %>"><%=scanListAr[i].initiate_id %></li> 
                                    
                                    <%   
                                    }
                                }
                                
                            %>
                                    
                            
                            <li class="draggable" value="2">Task2</li>
                            <li class="draggable" value="3">Task3</li>
                            <li class="draggable" value="4">Task4</li>
                            <li class="draggable" value="5">Task5</li>
                            <li class="draggable" value="6">Task6</li>
                            <li class="draggable" value="7">Task7</li>
                            </ul>
                            
                        </div> -->
                        </div>
                    
                            <h2>Priority</h2>
                        <div class="container">    
                        <div class="row">   
                            <div class="droppable bg-success text-white" style="background: #D6F0E0!important" value="3" > <% 
                                console.log(scanListAr.length);
                                    if(scanListAr.length>0 )
                                    {
                                        for(var i=0; i < scanListAr.length; i++) { 
                                         if(scanListAr[i].priority==3 && scanListAr[i].complete_status==0)  
                                         { 
                                        %>
                                        <li class="draggable bg-secondary text-white" value="<%=scanListAr[i].initiate_id %>" data-toggle="tooltip" data-placement="top" data-html="true" 
                                            title="User - <%=scanListAr[i].name %> <br> Collect name - <%=scanListAr[i].collect_name %> <br> Collect Mode - <%=scanListAr[i].type %> <br> Job Id - <%=scanListAr[i].job_id %>"><%=scanListAr[i].initiate_id %>
                                            <br>
                                            <%=scanListAr[i].collect_name %>
                                            <br>
                                            <%=scanListAr[i].name %>
                                            
                                        </li> 
                                        
                                        <%   
                                         }
                                        }
                                    }
                                    
                                %>
                               
                            </div>
                            
                            <div class="droppable bg-warning text-white" style="background:#FBF0DA!important" value="2"> <% 
                                console.log(scanListAr.length);
                                    if(scanListAr.length>0)
                                    {
                                        for(var i=0; i < scanListAr.length; i++) { 
                                         if(scanListAr[i].priority==2 && scanListAr[i].complete_status==0)  
                                         { 
                                        %>
                                        <li class="draggable bg-secondary  text-white" value="<%=scanListAr[i].initiate_id %>" data-toggle="tooltip" data-placement="top" data-html="true" 
                                            title="User - <%=scanListAr[i].name %> <br> Collect name - <%=scanListAr[i].collect_name %> <br> Collect Mode - <%=scanListAr[i].type %> <br> Job Id - <%=scanListAr[i].job_id %>"><%=scanListAr[i].initiate_id %>
                                            <br>
                                            <%=scanListAr[i].collect_name %>
                                            <br>
                                            <%=scanListAr[i].name %>
                                            
                                        </li> 
                                        
                                        <%   
                                         }
                                        }
                                    }
                                    
                                %> </div>
                            <div class="droppable bg-primary text-white" style="background: #DEF1F7!important" value="1"><% 
                                console.log(scanListAr.length);
                                    if(scanListAr.length>0)
                                    {
                                        for(var i=0; i < scanListAr.length; i++) { 
                                        if(scanListAr[i].priority==1 && scanListAr[i].complete_status==0)  
                                        { 
                                        %>
                                        <li class="draggable bg-secondary  text-white" value="<%=scanListAr[i].initiate_id %>" data-toggle="tooltip" data-placement="top" data-html="true" 
                                            title="User - <%=scanListAr[i].name %> <br> Collect name - <%=scanListAr[i].collect_name %> <br> Collect Mode - <%=scanListAr[i].type %> <br> Job Id - <%=scanListAr[i].job_id %>"><%=scanListAr[i].initiate_id %>
                                            <br>
                                            <%=scanListAr[i].collect_name %>
                                            <br>
                                            <%=scanListAr[i].name %>
                                            
                                        </li> 
                                        
                                        <%   
                                         }
                                        }
                                    }
                                    
                                %>
                            </div>
                            <div class="col-md-4">High</div>
                            <div class="col-md-4">Medium</div>
                            <div class="col-md-4">Low</div>
                        </div>
                        </div>
                        <h3>Jobs in processing</h3>
                        <div class="row" style="background:#f0ede8!important; padding: 10px;"> 
                            <%  
                            if(scanListAr.length>0)
                                    {
                                        for(var i=0; i < scanListAr.length; i++) { 
                                        if(scanListAr[i].complete_status==1)  
                                        { 
                                        %>
                                        <span class="badge badge-warning"  style=" margin: 5px; color:black;"><%=scanListAr[i].initiate_id %><br>
                                            <%=scanListAr[i].collect_name %>
                                            <br>
                                            <%=scanListAr[i].name %>
                                            </span>
                                       
                                        <%   
                                         }
                                        }
                                    }
                                    
                                %>
                        </div>                        

                </div>
                      

                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>
          
          <script>

            $(document).ready(function () {
              $('.input-daterange').datepicker({
                todayBtn: 'linked',
                format: "yyyy-mm-dd",
                autoclose: true
              });


              $('#example').DataTable({
                "paging": true,
                "pageLength": 10,
                "processing": true,
                "serverSide": true,
                "ajax": { url: "/web/admin/settingListData", type: 'POST' },
                "columns": [
                  { "data": "id" },
                  
                  { "data": "collect_name" },
                  
                  { "data": "job_id" },
                  { "data": "process_priority" },
                  //{ "data": "status" },
                  { "data": "assets" },
                 
                ]
              });
              //Search data filter
              $('#search').click(function () {
                ($('#startDate').val());
                var start_date = $('#start_date').val();
                var end_date = $('#end_date').val();
                var start_date1 = new Date($('#start_date').val());
                var end_date1 = new Date($('#end_date').val());

                if (start_date != '' && end_date != '') {
                  $('#example').DataTable().destroy();
                  fetch_data('yes', start_date, end_date);

                }
                else {
                  alert("Both Date is Required");
                }
                if (start_date1 >= end_date1) {
                  alert(start);
                  $('#example').DataTable().destroy();
                  fetch_data('yes', start_date1, end_date1);

                }

              });

            });

$(document).ready(function() {
    $("#example").dataTable({
        aaSorting: [[2, 'asc']],
        bPaginate: false,
        bFilter: false,
        bInfo: false,
        bSortable: true,
        bRetrieve: true,
        aoColumnDefs: [
            { "aTargets": [ 0 ], "bSortable": true },
            { "aTargets": [ 1 ], "bSortable": true },
            { "aTargets": [ 2 ], "bSortable": true },
            { "aTargets": [ 3 ], "bSortable": false }
        ]
    }); 
});
            
          </script>
        </body>
      </section>
      </body>
      </section>
    </div>

    <%- include ("footer") %>
      <style>
        table.dataTable {
          border-bottom: 1px solid #ddd !important;
        }
      </style>

<script type="text/javascript">
    $(function() {
      $('#lhs').sortable({ connectWith: '.droppable' })
      $('#rhs').sortable({ connectWith: '#lhs' })
      .on('sortable:receive', function(e, ui) {
        ui.item.removeClass('draggable');
       
      })
      $('.draggable').draggable({ connectWith: '#rhs' })
      $('.droppable').droppable({ activeClass: 'active', hoverClass: 'drop-here' })
    })
    
    $('.droppable').droppable()
    .on('droppable:drop',function(e, ui){

        let job= ui.item.attr('value');
        let priority=$(this).attr('value');
        console.log(job);
        console.log(priority);
        //location.reload();
        $.ajax({
            url:"/web/admin/updatejobs",
            method:"POST",
            data:{
                job:job, priority:priority
            },
            success:function(data){
                /*let datao=JSON.parse(data);
                if (datao.message) {
                      Swal.fire({
                        icon: 'success',
                        title: '',
                        text: datao.message,
                      });

                }*/
                location.reload();
                //swal('Order Changed Sussessfully.');setTimeout(function(){window.location.reload();},1000);},error: function(){swal('Something is wrong');
            }
        });
        //var tempid = $(this).attr('value');
      /* let job=$(ui.draggable).doSomething();
       var box = $(ui.draggable);
       //var value = tempid.attr("value");
       let priority=$(this).attr('value');
       // var value = tempid.attr("value");
       console.log('draggable',job);
       //var value = tempid.val();
        console.log(priority);*/

    })

  </script>

<style>
    .draggable, .droppable {
      border: 1px dashed #000;
      width: 290px;
      height: auto;
      background-color: #fff;
      display: inline-block;
      box-sizing: border-box;
      vertical-align: top;
    }
    
    .droppable {
      border-color: #31b03d;
      padding: 5px 2px;
    }
    
    .draggable.clone {
      background-color: #abe2a5;
    }
    
    .droppable.big {
      height: 60px;
      width: 100px;
    }
    
    .droppable.big .droppable {
      float: right;
    }
    
    .droppable.active {
      background-color: #abe2a5;
    }
    
    .droppable.drop-here {
      background-color: #3498db;
    }
    
    .droppable .draggable {
      width: auto;
      height: auto;
      margin: 0 3px;
      font-size: 13px;
      padding: 2px;
    }
    ul.list, ul.grid {
      list-style-type: none;
      padding: 0;
      width: 162px;
    }
    
    ul.grid.wide {
      width: 100%;
      height: auto;
    }
    
    ul.grid.active {
      background-color: #abe2a5;
    }
    
    ul.list li, ul.grid li {
      border: 1px solid #DCDBDD;
      margin: 2px;
      padding: 2px 5px;
      background-color: #F6F5F7;
      box-sizing: border-box;
      vertical-align: top;
    }
    
    ul.list li {
      height: 28px;
    }
    
    ul.grid li {
      float: left;
      height: auto;
      width: auto;
    }
    
    ul.list li.placeholder, ul.grid li.placeholder {
      border-style: dashed;
      background-color: transparent;
    }

    .tooltip-inner {
    max-width: 100% !important;
}
   
    </style>

